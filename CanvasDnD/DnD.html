<!DOCTYPE>
<html>
<head>
<title>Drag and Drop Prototype</title>
<style>
    #canvasHolder {height:90vh;width:600px;box-sizing:border-box;border:1px solid black;float:left;overflow:auto;}
    #canvasContext {position:absolute;left:-999px;z-index:999;list-style:none;font-family:Arial,sans-serif;
                    border:1px solid darkgray;margin:0;padding:5px 0;font-size:14px;line-height:24px;
                    box-shadow: 3px 5px 10px darkgray;min-width:125px;user-select:none;-webkit-user-select:none;background:white;}
    #canvasContext li {padding:0 20px 0 10px;cursor:default;}
    #canvasContext li:hover {color:white;background:#0066aa;}
    #zoom {float:left;}
    #zoom div {width:50px;height:50px;text-align:center;line-height:50px;}
    #dnd {border:1px solid black;}
    #properties {float:left;}
</style>


    <script type="text/javascript" src="Property.js"></script>
    <script type="text/javascript" src="Event.js"></script>
    <script type="text/javascript" src="Constants.js"></script>
    <script type="text/javascript" src="AnchorHandle.js"></script>
    <script type="text/javascript" src="Appearance.js"></script>
    <script type="text/javascript" src="Border.js"></script>
    <script type="text/javascript" src="Font.js"></script>
    <script type="text/javascript" src="Canvas.js"></script>
    <script type="text/javascript" src="Caption.js"></script>
    <script type="text/javascript" src="Layout.js"></script>
    <script type="text/javascript" src="TRBL.js"></script>
    <script type="text/javascript" src="FBObjects/FBObject.js"></script>
    <script type="text/javascript" src="FBObjects/Box.js"></script>
    <script type="text/javascript" src="FBObjects/Circle.js"></script>

</head>

<body>

<div id="formBuilder">
    <div id="canvasHolder">
        <canvas id="dnd"></canvas>
    </div>
    <ul id="canvasContext"></ul>
    <div id="zoom"></div>
    <div id="properties"></div>
</div>

<script type="text/javascript">






    class FormBuilder{
        constructor(){
            // Keep track of our HTML element
            this.builder = document.getElementById(FORM_BUILDER_ID);

            // Filled in by initializers
            this._canvas = null;
            this.canvasContext = null;
            this.zoomAmt = null;

            // Default page mode is portrait
            this.pageMode = PAGE_MODE_P;

            // Initialize everything
            this._initializeCanvas();
            this._initializeCanvasContext();
            this._initializeZoom();

            document.getElementsByTagName("html")[0].addEventListener("click", () => this._canvas.hideContextMenu());

            this._canvas.subscribe("shapechange", this._canvas_shapechange);
        }

        _initializeCanvas(){
            var _canvas = document.getElementById(CANVAS_ID);
            _canvas.width = this.pageMode == PAGE_MODE_P ? PAGE_WIDTH : PAGE_HEIGHT;
            _canvas.height = this.pageMode == PAGE_MODE_L ? PAGE_WIDTH : PAGE_HEIGHT;
            _canvas.addEventListener("contextmenu", (e) => this._canvas.showContextMenu(e));

            this._canvas = new Canvas(CANVAS_ID);
            this._canvas.scale = 1;
            this._canvas.addObject(new Circle(25, 25, 20));
            this._canvas.addObject(new Box(50, 200, 40, 20));
        }

        _initializeCanvasContext(){
            this.canvasContext = document.getElementById(CANVAS_CONTEXT_MENU_ID);

            var btf = document.createElement("li");
            btf.innerHTML = "Bring to Front";
            btf.addEventListener("mouseup", () => {this._canvas.bringActiveToFront(); this._canvas.hideContextMenu(); });
            this.canvasContext.appendChild(btf);

            var stb = document.createElement("li");
            stb.innerHTML = "Send to Back";
            stb.addEventListener("mouseup", () => {this._canvas.sendActiveToBack(); this._canvas.hideContextMenu(); });
            this.canvasContext.appendChild(stb);

            var del = document.createElement("li");
            del.innerHTML = "Delete";
            del.addEventListener("mouseup", () => {this._canvas.deleteActive(); this._canvas.hideContextMenu(); });
            this.canvasContext.appendChild(del);
        }

        _initializeZoom(){
            var zoom = document.getElementById(ZOOM_ID);
            var zoomIn = document.createElement("div");
            var zoomOut = document.createElement("div");
            this.zoomAmt = document.createElement("div");

            zoomIn.addEventListener("click", () => this._zoomIn());
            zoomIn.innerHTML = "+";
            zoom.appendChild(zoomIn);

            zoomOut.addEventListener("click", () => this._zoomOut());
            zoomOut.innerHTML = "-";
            zoom.appendChild(zoomOut);

            zoom.appendChild(this.zoomAmt);

            this._updateZoomAmt();
        }

        _zoomIn(){
            if(Math.ceil(this._canvas.scale / .1) * .1 == this._canvas.scale){
                this._canvas.scale += .1;
            }
            else{
                this._canvas.scale = Math.ceil(this._canvas.scale / .1) * .1;
            }

            this._updateZoomAmt();
        }

        _zoomOut(){
            if(Math.floor(this._canvas.scale / .1) * .1 == this._canvas.scale){
                this._canvas.scale = Math.max(0.1, this._canvas.scale - 0.1);
            }
            else{
                this._canvas.scale = Math.floor(this._canvas.scale / .1) * .1;
            }

            this._updateZoomAmt();
        }

        _updateZoomAmt(){
            this.zoomAmt.innerHTML = (this._canvas.scale * 100).toFixed(2) + "%";

            this._canvas._canvas.width = (this.pageMode == PAGE_MODE_P ? PAGE_WIDTH : PAGE_HEIGHT) * this._canvas.scale;
            this._canvas._canvas.height = (this.pageMode == PAGE_MODE_L ? PAGE_WIDTH : PAGE_HEIGHT) * this._canvas.scale;
        }

        _canvas_shapechange(e){
            var propBox = document.getElementById(PROPERTIES);
            while(propBox.firstChild) propBox.removeChild(propBox.firstChild);

            // Gets back the property categories

        }

        _loadAppearanceProperties(props){
            var div = document.createElement("div");
            div.className = "property";

        }

        _loadSizeLocationProperties(props){

        }
    }

    var fb = new FormBuilder();

</script>

</body>
</html>